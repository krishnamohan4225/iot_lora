<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
    <script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap.min.js"></script>
</head>
<body>
    <script>
        window.onload = getddata();
        function getddata() {
            var xmlhttp = new XMLHttpRequest();
            xmlhttp.onreadystatechange = function () {
                if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                    var Readings = JSON.parse(xmlhttp.responseText);
                    //jquery data table - start
                    $(document).ready(function () {
                        $('#example').DataTable({
                            data: Readings,
                            columns: [
                                {
                                    data: 'timestamp', title: 'timestamp',
                                    render: function (data) {
                                        var updDate = UtcToIst(data).toLocaleDateString();
                                        var updTime = UtcToIst(data).toLocaleTimeString();
                                        var updDateTime = updDate + ", " + updTime;
                                        return updDateTime;
                                    }
                                },

                                {
                                    data: 'dataFrame', title: 'deviceid',
                                    render: function (data) {
                                        var hexvalue = base64toHEX(data);
                                        return hexToDec(hexvalue.substr(1, 1));
                                    }
                                },


                                {
                                    data: 'fcnt', title: 'FCNT',
                                    render: function (data) {
                                        return data;
                                    }
                                },

                                {
                                    data: 'dataFrame', title: 'Oil temp',
                                    render: function (data) {
                                        var hexvalue = base64toHEX(data);
                                        return hexToDec(hexvalue.substr(2, 2));
                                    }
                                },
                                {
                                    data: 'dataFrame', title: 'Winding temp',
                                    render: function (data) {
                                        var hexvalue = base64toHEX(data);
                                        return hexToDec(hexvalue.substr(4, 2));
                                    }
                                },
                                {
                                    data: 'dataFrame', title: 'Ambient temp',
                                    render: function (data) {
                                        var hexvalue = base64toHEX(data);
                                        return hexToDec(hexvalue.substr(6, 2));
                                    }
                                }
                            ],
                            order: [2]
                        });
                    });
                    //data table code -close

                }
            };
            xmlhttp.open("GET", "https:/[tcl_domain_name]/[deviceid]/payloads/ul", true);
            xmlhttp.setRequestHeader("Authorization", "Basic a2Vybm");
            xmlhttp.setRequestHeader("Content-type", "Application/json");
            xmlhttp.send();
        }
        //HexToDec for converting hexadecimal data to decimal
        function base64toHEX(base64) {
            var raw = atob(base64);
            var HEX = '';
            for (i = 0; i < raw.length; i++) {
                var _hex = raw.charCodeAt(i).toString(16)
                HEX += (_hex.length == 2 ? _hex : '0' + _hex);
            }
            return HEX.toUpperCase();
        }
        function hexToDec(hex) {
            return hex.toLowerCase().split('').reduce((result, ch) =>
                result * 16 + '0123456789abcdefgh'.indexOf(ch), 0);
        }

        function UtcToIst(data) {
            var dt = new Date(data);
            return dt;
        }
    </script>
    <p id="data"></p>
    <table id="example" class="table table-striped table-bordered" style="width:100%">
        <thead>
            <tr>
                <th>Time</th>
                <th>Device id </th>
                <th>FCNT </th>
                <th>Oil Tempreture</th>
                <th>Winding Temperature</th>
                <th>Ambient Temperature</th>
            </tr>
        </thead>
    </table>
</body>
</html>
